@model BalancedSoccerTeam.Models.TeamGenerationViewModel

@{
    ViewData["Title"] = "Select Players";
}

<h1>Generate Balanced Teams</h1>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<form asp-action="GenerateTeams" method="post">
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Select Present Players</h4>
            <button type="button" id="selectAllBtn" class="btn btn-sm btn-secondary">Select All</button>
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Name</th>
                        <th>Overall Score</th>
                        <th>Rank</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.AvailablePlayers.Count; i++)
                    {
                        <tr>
                            <td>
                                <input type="checkbox"
                                       name="selectedPlayerIds"
                                       value="@Model.AvailablePlayers[i].Id"
                                       class="form-check-input player-checkbox" />
                            </td>
                            <td>@Model.AvailablePlayers[i].Name</td>
                            <td>@Model.AvailablePlayers[i].OverallScore.ToString("F1")</td>
                            <td>@Model.AvailablePlayers[i].Rank</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="form-group mb-3">
        <label for="numberOfTeams" class="form-label">Number of Teams:</label>
        <input type="number"
               id="numberOfTeams"
               name="numberOfTeams"
               class="form-control"
               min="2"
               max="10"
               value="2"
               required
               style="max-width: 200px;" />
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-success">Generate Teams</button>
        <a asp-action="Index" class="btn btn-secondary">Back to Players</a>
    </div>
</form>

@section Scripts {
    <script>
        document.getElementById('selectAllBtn').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('.player-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);

            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked;
            });

            this.textContent = allChecked ? 'Select All' : 'Deselect All';
        });
    </script>
}